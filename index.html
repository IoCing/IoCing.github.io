<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å’Œèµ–èµ–å¿«ä¹å¼€å¿ƒæ¯ä¸€å¤©ğŸŒ¼">
<meta property="og:type" content="website">
<meta property="og:title" content="IoCing">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="IoCing">
<meta property="og:description" content="å’Œèµ–èµ–å¿«ä¹å¼€å¿ƒæ¯ä¸€å¤©ğŸŒ¼">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="IoCing">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>IoCing</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IoCing</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">åˆ†äº«æ˜¯æœ€å¥½çš„è®°å½•</p>
      <a>
        <img class="custom-logo-image" src="[object Object]" alt="IoCing">
      </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/06/raft%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IoCing">
      <meta itemprop="description" content="å’Œèµ–èµ–å¿«ä¹å¼€å¿ƒæ¯ä¸€å¤©ğŸŒ¼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IoCing">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/06/raft%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" class="post-title-link" itemprop="url">raftæºç é˜…è¯»</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-06-06 17:10:06 / Modified: 21:27:00" itemprop="dateCreated datePublished" datetime="2022-06-06T17:10:06+08:00">2022-06-06</time>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>15 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="etcd-raftæºç é˜…è¯»"><a href="#etcd-raftæºç é˜…è¯»" class="headerlink" title="etcd raftæºç é˜…è¯»"></a>etcd raftæºç é˜…è¯»</h1><p>[TOC]</p>
<blockquote>
<p><strong>å…ˆæ¢³ç†ä¸€ä¸‹æ•´ä½“çš„åŒ…ç»“æ„</strong></p>
<p>ä¸»ç›®å½•ä»£ç ä¸­æœ‰å¤šä¸ªpackageï¼Œæ¯ä¸ªä¸»è¦çš„raftçš„é€»è¾‘å®ç°åœ¨raft packageä¸­ï¼Œå…¶ä»–çš„packageä¸»è¦æ˜¯ä¸ºraftæä¾›æ”¯æŒï¼Œä¾‹å¦‚é€‰ä¸¾ï¼ŒçŠ¶æ€è¿½è¸ªï¼Œè¿˜æœ‰åŸå‹photo bufferçš„å®šä¹‰ç­‰ç­‰ã€‚</p>
<p><strong>ç„¶åæ¢³ç†ä¸€ä¸‹ä¸Šå±‚åº”ç”¨å±‚å’Œåº•å±‚raftçš„ä¸€äº›è°ƒç”¨å…³ç³»</strong></p>
<p>åº•å±‚raftä½¿ç”¨Nodeæ¥å£ä¸ºä¸Šå±‚æä¾›äº†å¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶ä»–çš„å®ç°ç»†èŠ‚éƒ½éšè—ï¼Œåº”ç”¨å±‚å’Œraftå±‚éƒ½è¦é€šè¿‡å‡ ä¸ªchannelæ¥æ”¶å‘Msgï¼Œå…·ä½“çš„channel ä»¥åŠæ¶ˆæ¯çš„ç±»å‹å’Œå¤„ç†ä¹‹åå†æ·±å…¥ã€‚</p>
</blockquote>
<h1 id="raft-package"><a href="#raft-package" class="headerlink" title="raft package"></a>raft package</h1><p>å…ˆæ¥åˆ—ä¸€ä¸‹raftpackageä¸­çš„ä¸€äº›ä¸»è¦çš„ç»“æ„ä½“ä»¥åŠå¯¹åº”çš„æ–¹æ³•</p>
<p>è¿˜è‡ªé¡¶å¾€ä¸‹çœ‹å§ï¼Œè¿™æ ·çš„è¯å¥½å±•å¼€ä¹Ÿå¥½ç†è§£æ•´ä½“çš„æ¡†æ¶ï¼Œç°åœ¨ä¸è®¨è®ºåº”ç”¨å±‚çš„å®ç°ï¼Œåªå…³æ³¨raftåº•å±‚ä»¥åŠåœ¨ä¸­é—´ç”¨äºé€šä¿¡è½¬æ¥çš„nodeã€‚rawNodeæ˜¯å¯¹raftçš„å°è£…ã€‚nodeæ˜¯Nodeæ¥å£çš„å®ç°ï¼Œnodeé‡Œé¢åŒ…å«äº†ä¸€ä¸ªrawNodeçš„å®ä¾‹ï¼Œå€Ÿæ­¤æ¥æ“ä½œraftåº•å±‚çš„å„ç§å‡½æ•°ã€‚</p>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><table>
<thead>
<tr>
<th>Nodeæ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Tick</td>
<td>è¿™ä¸ªæ˜¯ç”¨æ¥è§¦å‘heartbeatä»¥åŠelectionçš„å‡½æ•°ï¼Œæ¯æ¬¡éƒ½ä¼šè°ƒç”¨ä¸‹å±‚raftçš„tickå‡½æ•°æ¥å¯¹electionElapsedå’ŒheartbeatElapsedè¿›è¡Œæ›´æ–°ï¼Œå¦‚æœåˆ¤æ–­è¶…æ—¶çš„è¯å°±åšç›¸åº”çš„å¤„ç†</td>
</tr>
<tr>
<td>Campaign</td>
<td>è®©Node è½¬å˜ä¸ºcandidateå¹¶ä¸”å¼€å§‹ä¸€æ¬¡é€‰ä¸¾</td>
</tr>
<tr>
<td>Propose</td>
<td>ç”¨æ¥æäº¤éœ€è¦å†™åˆ°logä¸­çš„æ•°æ®ï¼Œæäº¤æ˜¯æœ‰å¯èƒ½å¤±è´¥çš„ï¼Œéœ€è¦useræ¥ç¡®å®šproposeçš„è¿”å›</td>
</tr>
<tr>
<td>ProposeConfChange</td>
<td>ç”¨æ¥æäº¤ä¸€ä¸ªé…ç½®æ›´æ”¹</td>
</tr>
<tr>
<td>Step</td>
<td>Step ä½¿ç”¨ç»™å®šçš„æ¶ˆæ¯æ¨è¿›çŠ¶æ€æœºï¼Œä¸åŒçš„raftçŠ¶æ€å¯¹åº”ä¸åŒçš„stepå¤„ç†</td>
</tr>
<tr>
<td>Ready</td>
<td>è¿”å›ä¸€ä¸ªé€šé“ï¼Œè¿™ä¸ªé€šé“ä¼šè¿”å›å½“å‰ä¸€ä¸ªç‚¹çš„çŠ¶æ€ã€‚Nodeçš„useråœ¨æ”¶åˆ°readyæ•°æ®å¹¶ä¸”è¿›è¡Œå¤„ç†ä»¥åï¼Œéœ€è¦è°ƒç”¨advanceã€‚åªæœ‰å‰é¢readyçš„snapï¼Œentrieséƒ½appliedäº†ï¼Œæ‰èƒ½æäº¤ä¹‹åreadyä¸­çš„entries</td>
</tr>
<tr>
<td>Advance</td>
<td>advanceæ˜¯ç»™application å±‚ç”¨æ¥é€šçŸ¥raftï¼Œä¸Šå±‚å·²ç»å¤„ç†äº†æœ€åä¸€ä¸ªreadyçš„æ•°æ®ï¼Œåº•å±‚raftå°±å¯ä»¥äº†å¯¹readyä¸­çš„çŠ¶æ€è¿›è¡Œå¤„ç†ï¼Œä¹Ÿè®©nodeå¼€å§‹å‡†å¤‡ä¼ è¾“ä¸‹ä¸€æ¬¡ready</td>
</tr>
<tr>
<td>ApplyConfChange</td>
<td>æäº¤ä¸€ä¸ªconfçš„å˜æ›´</td>
</tr>
<tr>
<td>TransferLeadership</td>
<td>TransferLeadership å°è¯•å°†é¢†å¯¼æƒè½¬ç§»ç»™ç»™å®šçš„å—è®©äººã€‚</td>
</tr>
<tr>
<td>ReadIndex</td>
<td>ç”¨æ¥è¯·æ±‚ä¸€ä¸ªread stateã€‚è¿™ä¸ªread stateä¼šåœ¨readyä¸­è®¾ç½®ï¼Œread stateæœ‰ä¸€ä¸ªread indexã€‚åªæœ‰åœ¨åº”ç”¨å±‚advanceçš„indexæ¯”è¿™ä¸ªread indexæ›´å¤§æ—¶å†èƒ½å®‰å…¨çš„è¯»ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯linearizable readã€‚</td>
</tr>
<tr>
<td>Status</td>
<td>Status returns the current status of the raft state machine</td>
</tr>
<tr>
<td>ReportUnreachable</td>
<td>ç”¨æ¥å‘raftæŠ¥å‘ŠæŸä¸€ä¸ªèŠ‚ç‚¹ç°åœ¨æ˜¯unreachable</td>
</tr>
<tr>
<td>ReportSnapshot</td>
<td>ç”¨æ¥å‘leaderæŠ¥å‘ŠæŸä¸€ä¸ªfollowerå¯¹snapå¤„ç†çš„ç»“æœ</td>
</tr>
<tr>
<td>Stop</td>
<td>Stop performs any necessary termination of the Node.</td>
</tr>
</tbody></table>
<p>åœ¨åº”ç”¨å±‚è°ƒç”¨Nodeï¼Œä¸»è¦å…³æ³¨readyçš„å¤„ç†ï¼Œä»¥åŠè°ƒç”¨advanceï¼Œè¿˜è¦å®šæ—¶è°ƒç”¨Tickï¼Œè¿™ä¸ªæ˜¯Node userçš„èŒè´£ã€‚</p>
<p>å…³äºNodeæ¥å£çš„ä½¿ç”¨å¯ä»¥åœ¨etcdæä¾›çš„raftexamplä¸­å­¦ä¹ ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„kvserverï¼Œä½¿ç”¨raftåšåº•å±‚çŠ¶æ€æœºã€‚</p>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p><img src="https://iocing-image.oss-cn-shenzhen.aliyuncs.com/img/config.png"></p>
<p>åœ¨configç»“æ„ä½“ä¸­ä¸»è¦åŒ…å«äº†ä¸€äº›å¯¹raftåˆå§‹åŒ–çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚é€‰ä¸¾å¿ƒè·³çš„é—´éš”ï¼Œå­˜å‚¨å¼•æ“ç­‰ç­‰ï¼Œä¸‹é¢åˆ—å‡ºä»–çš„å„ç§å˜é‡ã€‚</p>
<table>
<thead>
<tr>
<th>cinfigå˜é‡</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>uint64</td>
<td>server çš„ID èº«ä»½æ ‡è¯†</td>
</tr>
<tr>
<td>ElectionTick</td>
<td>int</td>
<td>èŠ‚ç‚¹é€‰ä¸¾çš„é—´éš”</td>
</tr>
<tr>
<td>HeartbeatTick</td>
<td>Int</td>
<td>èŠ‚ç‚¹å‘é€å¿ƒè·³çš„é—´éš”</td>
</tr>
<tr>
<td>Storage</td>
<td>Storage</td>
<td>ä¸ºraftæä¾›å­˜å‚¨æœåŠ¡çš„å®ä¾‹</td>
</tr>
<tr>
<td>Applied</td>
<td>uint64</td>
<td>æœ€åä¸€ä¸ªå·²æäº¤çš„entryçš„index</td>
</tr>
<tr>
<td>MaxSizePerMsg</td>
<td>uint64</td>
<td>å¯¹append messageçš„å¤§å°é™åˆ¶</td>
</tr>
<tr>
<td>MaxCommittedSizePerReady</td>
<td>uint64</td>
<td>å¯¹ä¸€ä¸ªreadyä¸­å¯ä»¥æäº¤çš„entryçš„å¤§å°é™åˆ¶</td>
</tr>
<tr>
<td>MaxUncommittedEntriesSize</td>
<td>uint64</td>
<td>å¯¹æœªæäº¤çš„entryçš„å¤§å°é™åˆ¶ï¼Œä¸»è¦æ˜¯é’ˆå¯¹leaderçš„log</td>
</tr>
<tr>
<td>MaxInflightMsgs</td>
<td>int</td>
<td>MaxInflightMsgs limits the max number of in-flight append messages during optimistic replication phase.</td>
</tr>
<tr>
<td>CheckQuorum</td>
<td>bool</td>
<td>æ ‡å¿—leaderæ˜¯å¦éœ€è¦è¿›è¡Œcheck quorumæ“ä½œ</td>
</tr>
<tr>
<td>PreVote</td>
<td>bool</td>
<td>åº”è¯¥æ˜¯æ˜¯å¦å¼€å¯PreVote</td>
</tr>
<tr>
<td>ReadOnlyOption</td>
<td>ReadOnlyOption</td>
<td>æ ‡å¿—readonlyå¦‚ä½•è¿›è¡Œ</td>
</tr>
<tr>
<td>Logger</td>
<td>Logger</td>
<td>ç»™æ¯ä¸ªraftçš„logger</td>
</tr>
<tr>
<td>DisableProposalForwarding</td>
<td>bool</td>
<td>è¿™ä¸ªæ ‡å¿—ä¸ºtrueçš„è¯ï¼Œfollowerä¼šä¸¢æ‰æ¥è‡ªleaderçš„æäº¤</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>cinfigæ–¹æ³•</th>
<th>å‚æ•°</th>
<th>è¿”å›ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>validate()</td>
<td>æ— </td>
<td>error</td>
<td>éªŒè¯å‚æ•°çš„æœ‰æ•ˆæ€§</td>
</tr>
</tbody></table>
<p>ä¸Šå±‚å¯ä»¥è°ƒç”¨newRaftå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªConfigæ¥å¯¹raftè¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<h3 id="raft"><a href="#raft" class="headerlink" title="raft"></a>raft</h3><p>raft structæ˜¯Raftå®ç°ä¸­æœ€æ ¸å¿ƒçš„ç»“æ„ï¼Œè´Ÿè´£leader electionï¼Œlog replicateï¼Œä»¥åŠserverå„ç§çŠ¶æ€çš„å˜æ¢ç­‰é€»è¾‘çš„å®ç°ï¼Œå¯ä»¥è¯´ä¸€ä¸ªraftå®ä¾‹å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚è¿™ä¸ªåœ¨è®ºæ–‡ä¸­æœ‰ä¸€å¼ å›¾å±•ç¤ºäº†çŠ¶æ€å„ç§å˜åŒ–çš„æ¡ä»¶ã€‚</p>
<p>è¿™ä¸ªè¯»è¿‡è®ºæ–‡çš„éƒ½ä¼šæ¯”è¾ƒç†Ÿæ‚‰ã€‚</p>
<p>ä¸‹é¢åˆ—ä¸€ä¸‹raftä¸­çš„å„ç§å˜é‡å’Œæ–¹æ³•æ¥å¯¹raftæ›´æ·±å…¥ç†è§£</p>
<table>
<thead>
<tr>
<th>raftå˜é‡</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>unit64</td>
<td>raftçš„ç¼–å·</td>
</tr>
<tr>
<td>Term</td>
<td>Uint64</td>
<td>term number</td>
</tr>
<tr>
<td>Vote</td>
<td>Unit64</td>
<td>è®°å½•vote forçš„server</td>
</tr>
<tr>
<td>readStates</td>
<td>ReadState</td>
<td>ReadState provides state for read only query</td>
</tr>
<tr>
<td>raftLog</td>
<td>*raftLog</td>
<td>å¯¹logçš„è®°å½•ï¼Œä¹Ÿä¼šè®°å½•commitedï¼Œlast apllied</td>
</tr>
<tr>
<td>maxMsgSize</td>
<td>uint64</td>
<td>åŒconfigä¸­çš„maxMsgSize</td>
</tr>
<tr>
<td>maxUncommittedSize</td>
<td>uint64</td>
<td>åŒconfigä¸­çš„maxUncommittedSize</td>
</tr>
<tr>
<td>prs</td>
<td>tracker.ProgressTracker</td>
<td>è¿™ä¸ªç”¨æ¥è®°å½•å…¶ä»–serveråœ¨leaderçœ¼ä¸­çš„çŠ¶æ€ï¼Œè®°å½•nextï¼Œmatchä¿¡æ¯</td>
</tr>
<tr>
<td>state</td>
<td>StateType</td>
<td>å½“å‰çš„çŠ¶æ€followerï¼Œleaderï¼Œcandidate</td>
</tr>
<tr>
<td>isLearner</td>
<td>bool</td>
<td>æ ‡è®°æ˜¯å¦ä¸ºleader</td>
</tr>
<tr>
<td>msgs</td>
<td>[]pb.Message</td>
<td>ç”¨æ¥å­˜æ”¾è¦å‘é€çš„æ¶ˆæ¯ï¼Œé€šè¿‡readyç»Ÿä¸€å¤„ç†</td>
</tr>
<tr>
<td>lead</td>
<td>Unit64</td>
<td>the leader id</td>
</tr>
<tr>
<td>leadTransferee</td>
<td>uint64</td>
<td>leadTransferee is id of the leader transfer target when its value is not zero.Follow the procedure defined in raft thesis 3.10.</td>
</tr>
<tr>
<td>pendingConfIndex</td>
<td>uint64</td>
<td>åœ¨é…ç½®å˜æ›´æ—¶ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å…è®¸ã€‚Only one conf change may be pending (in the log, but not yet applied) at a time. This is enforced via pendingConfIndex, which  is set to a value &gt;&#x3D; the log index of the latest pending configuration change (if any). Config changes are only allowed to be proposed if the leaderâ€™s applied index is greater than this value.</td>
</tr>
<tr>
<td>uncommittedSize</td>
<td>uint64</td>
<td>åŒconfig</td>
</tr>
<tr>
<td>readOnly</td>
<td>*readOnly</td>
<td>ç”¨æ¥å¤„ç†read onlyçš„ç»“æ„ä½“</td>
</tr>
<tr>
<td>electionElapsed</td>
<td>int</td>
<td>è®°å½•ä¸Šæ¬¡æœ‰æ•ˆæ¶ˆæ¯åˆ°ç°åœ¨çš„æ—¶é—´ï¼Œåˆ¤æ–­ä¸€ä¸ªraftæ˜¯å¦è¦å¼€å§‹é€‰ä¸¾</td>
</tr>
<tr>
<td>heartbeatElapsed</td>
<td>int</td>
<td>è®°å½•ä¸Šæ¬¡æ”¶åˆ°å¿ƒè·³heartbeatTimeoutåˆ°ç°åœ¨çš„æ—¶é—´ï¼Œåªæœ‰leaderåœ¨æ„è¿™ä¸ªå‚æ•°</td>
</tr>
<tr>
<td>checkQuorum</td>
<td>bool</td>
<td>åŒconfig</td>
</tr>
<tr>
<td>preVote</td>
<td>bool</td>
<td>åŒconfig</td>
</tr>
<tr>
<td>heartbeatTimeout</td>
<td>int</td>
<td>å¿ƒè·³è¶…æ—¶é—´éš”</td>
</tr>
<tr>
<td>electionTimeout</td>
<td>int</td>
<td>é€‰ä¸¾è¶…æ—¶é—´éš”</td>
</tr>
<tr>
<td>randomizedElectionTimeout</td>
<td>int</td>
<td>randomizedElectionTimeout is a random number between  [electiontimeout, 2 * electiontimeout - 1]. It gets reset when raft changes its state to follower or candidate</td>
</tr>
<tr>
<td>disableProposalForwarding</td>
<td>bool</td>
<td>åŒconfig</td>
</tr>
<tr>
<td>tick</td>
<td>func()</td>
<td>ä¸ºraftæŒ‡å®šçš„tickå‡½æ•°ï¼Œæ§åˆ¶å¿ƒè·³å’Œé€‰ä¸¾</td>
</tr>
<tr>
<td>step</td>
<td>stepFunc ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹</td>
<td>ç”¨æ¥å¤„ç†å„ç§ä¿¡æ¯çš„å‡½æ•°ï¼Œä¸åŒçš„çŠ¶æ€æ”¶åˆ°ä¸åŒçš„ä¿¡æ¯å¯¹åº”ä¸åŒçš„å¤„ç†</td>
</tr>
<tr>
<td>logger</td>
<td>Logger</td>
<td>æ—¥å¿—</td>
</tr>
<tr>
<td>pendingReadIndexMessages</td>
<td>[]pb.Message</td>
<td>ç”¨æ¥å­˜æ”¾è¿˜ä¸èƒ½åšå›å¤çš„readindexæ¶ˆæ¯ï¼Œå› ä¸ºè¿™ä¸ªindexç°åœ¨çš„raftè¿˜æ²¡æœ‰commited</td>
</tr>
</tbody></table>
<h3 id="raft-softstate"><a href="#raft-softstate" class="headerlink" title="raft softstate"></a>raft softstate</h3><h3 id="raft-hardstate"><a href="#raft-hardstate" class="headerlink" title="raft hardstate"></a>raft hardstate</h3><h3 id="raft-process-state"><a href="#raft-process-state" class="headerlink" title="raft process state"></a>raft process state</h3><h3 id="raftlog"><a href="#raftlog" class="headerlink" title="raftlog"></a>raftlog</h3><p>ä¸Šé¢åˆ—å‡ºäº†raftåŒ…å«çš„æ‰€æœ‰å˜é‡ï¼Œä¸‹é¢æ¥ç ”ç©¶ä¸€ä¸‹raftçš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯æä¾›ç»™Nodeä¸­çš„æ–¹æ³•åšçš„åº•å±‚çš„å®ç°ï¼Œæˆ‘ç°åœ¨å¼€å§‹ç ”ç©¶ä¸€ä¸‹ä»–ä»¬çš„ç»†èŠ‚ã€‚</p>
<h3 id="raft-tickå¤„ç†"><a href="#raft-tickå¤„ç†" class="headerlink" title="raft tickå¤„ç†"></a>raft tickå¤„ç†</h3><p>å…³äºtickçš„å¤„ç†æœ‰ä¸¤ç§</p>
<table>
<thead>
<tr>
<th>raft tickæ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>å®ç°</th>
</tr>
</thead>
<tbody><tr>
<td>tickElection</td>
<td>tickElection is run by followers and candidates after r.electionTimeout.</td>
<td>å…ˆå°†electionElapsedåŠ ä¸€ï¼Œå¦‚æœè‡ªå·±å½“å‰çŠ¶æ€å¯ä»¥åšleaderï¼Œå¹¶ä¸”é€‰ä¸¾è¶…æ—¶ï¼Œé‚£ä¹ˆå°±å‘èµ·ä¸€æ¬¡é€‰ä¸¾</td>
</tr>
<tr>
<td>tickHeartbeat</td>
<td>tickHeartbeat is run by leaders to send a MsgBeat after r.heartbeatTimeout.</td>
<td>è¿™æ˜¯leaderç”¨æ¥å¤„ç†ä¸Šå±‚è°ƒç”¨tickçš„æ–¹æ³•ï¼Œæ›´æ–°electionElapsedï¼Œå¦‚æœå¿ƒè·³è¶…æ—¶å°±å¹¿æ’­å‘é€å¿ƒè·³æ¶ˆæ¯</td>
</tr>
</tbody></table>
<p>raftä¸­çš„electionElapsedï¼ŒheartbeatElapsedå°±æ˜¯ç”¨æ¥è®°å½•é—´éš”çš„ï¼Œä¸Šå±‚å®šæ—¶è°ƒç”¨tickï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ç»™è¿™ä¸¤ä¸ªå˜é‡åŠ ä¸€ã€‚ç›´åˆ°è¶…æ—¶åå°±å°†è¿™ä¿©ä¸ªå˜é‡é‡åˆ¶ä¸º0.</p>
<h3 id="raftå„ç§çŠ¶æ€çš„è½¬æ¢"><a href="#raftå„ç§çŠ¶æ€çš„è½¬æ¢" class="headerlink" title="raftå„ç§çŠ¶æ€çš„è½¬æ¢"></a>raftå„ç§çŠ¶æ€çš„è½¬æ¢</h3><p><img src="https://iocing-image.oss-cn-shenzhen.aliyuncs.com/img/state.png" alt="çŠ¶æ€è½¬æ¢"></p>
<p>è¿™äº›è½¬æ¢çš„æ—¶æœºå¦‚ä¸Šå›¾ï¼Œåªä¸è¿‡åŠ äº†é¢„é€‰ä¸¾çš„çŠ¶æ€ã€‚</p>
<table>
<thead>
<tr>
<th>raft becomeæ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>å®ç°</th>
</tr>
</thead>
<tbody><tr>
<td>becomeFollower</td>
<td>æ”¶åˆ°äº†æœ‰æ•ˆçš„å¿ƒè·³ï¼Œæˆ–è€…å‘ç°äº†æ›´é«˜termçš„leaderä¿®æ”¹å½“å‰çŠ¶æ€ä¸ºfollower</td>
<td></td>
</tr>
<tr>
<td>becomeCandidate</td>
<td>precandidateæˆåŠŸï¼Œä¿®æ”¹å½“å‰çŠ¶æ€ä¸ºcandidate</td>
<td></td>
</tr>
<tr>
<td>becomePreCandidate</td>
<td>é€‰ä¸¾æ—¶é—´è¶…æ—¶ï¼Œå¼€å§‹ä¸€æ¬¡é€‰ä¸¾ï¼Œä¿®æ”¹å½“å‰çŠ¶æ€ä¸ºprecandidate</td>
<td></td>
</tr>
<tr>
<td>becomeLeader</td>
<td>é€‰ä¸¾æˆåŠŸï¼Œä¿®æ”¹å½“å‰çŠ¶æ€ä¸ºleader</td>
<td></td>
</tr>
</tbody></table>
<p>æ„Ÿè§‰precandidateç›¸å½“äºä¸å¢åŠ termè¿›è¡Œä¸€æ¬¡é€‰ä¸¾ï¼Œçœ‹ä¸€çœ‹è¿™ä¸ªserveræ˜¯å¦æœ‰æœ€updateçš„logï¼Œèƒ½ä¸èƒ½å½“é€‰ã€‚å¦‚æœå¯ä»¥çš„è¯å†è¿›è¡Œæ­£å¼çš„é€‰ä¸¾ï¼Œå¹¶ä¸”è½¬æ¢åˆ°candidateçŠ¶æ€ï¼Œç»™term+1</p>
<p>è¿™å‡ ä¸ªå‡½æ•°çš„å®ç°ä¸­ï¼Œåªæœ‰becomeLeaderçš„æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œå…¶ä»–ä¸‰ä¸ªéƒ½æ˜¯è®¾ç½®å¯¹åº”çš„stepå‡½æ•°å’Œtickå‡½æ•°ï¼Œä»¥åŠä¸€äº›å‚æ•°çš„è®¾ç½®ï¼ŒbecomeCandidateéœ€è¦å°†termå¢åŠ ã€‚</p>
<p>ä¸‹é¢ç ”ç©¶ä¸€ä¸‹becomeLeaderçš„ç»†èŠ‚ï¼Œç›´æ¥è´´ä»£ç å§</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *raft)</span></span> becomeLeader() &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ£€æŸ¥æ˜¯å¦æ˜¯ä¸åˆæ³•çš„çŠ¶æ€è½¬æ¢</span></span><br><span class="line">   <span class="keyword">if</span> r.state == StateFollower &#123;</span><br><span class="line">      <span class="built_in">panic</span>(<span class="string">&quot;invalid transition [follower -&gt; leader]&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment">//å¸¸è§„çš„å‚æ•°è®¾ç½®</span></span><br><span class="line">   r.step = stepLeader</span><br><span class="line">   r.reset(r.Term)</span><br><span class="line">   r.tick = r.tickHeartbeat</span><br><span class="line">   r.lead = r.id</span><br><span class="line">   r.state = StateLeader</span><br><span class="line">	<span class="comment">//å°†è‡ªå·±åœ¨prsä¸­çš„çŠ¶æ€è®¾ç½®ä¸ºreplicate è¿™ä¸ªæ˜¯serveråœ¨leaderçœ¼ä¸­çš„çŠ¶æ€æœ‰ï¼Œprobeï¼Œreplicateï¼Œsnapshotä¸‰ç§ï¼Œleaderä¼šæ ¹æ®serverçš„çŠ¶æ€é‡‡å–ä¸åŒçš„æ“ä½œä¾‹å¦‚append logï¼Œä¼ é€snapç­‰ã€‚</span></span><br><span class="line">   r.prs.Progress[r.id].BecomeReplicate()</span><br><span class="line">  <span class="comment">//è¿™ä¸ªpendingConfIndexçš„å‚æ•°æ˜¯åœ¨é…ç½®å˜æ¢æ—¶ä¼šç”¨åˆ°ï¼Œç­‰çœ‹åˆ°é…ç½®å˜æ¢å†æ·±å…¥</span></span><br><span class="line">   r.pendingConfIndex = r.raftLog.lastIndex()</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿™é‡Œæ˜¯æ–°å»ºäº†ä¸€ä¸ªç©ºçš„entryï¼Œè¿™æ˜¯etcd raftçš„ä¸€ä¸ªæ”¹è¿›ï¼Œå› ä¸ºraftè®¾è®¡çš„ä¸€ä¸ªcommitedçš„é™åˆ¶æ˜¯leaderåªèƒ½commitedå½“å‰termçš„entryï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œå½“é€‰leaderçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯commitedä¸€ä¸ªç©ºçš„entryæ¥commit leaderå’Œå…¶ä»–serverä¸­æœªcommitedçš„entryå…¶ä»–å…±è¯†</span></span><br><span class="line">   emptyEnt := pb.Entry&#123;Data: <span class="literal">nil</span>&#125;</span><br><span class="line">  <span class="comment">//å°†è¿™ä¸ªç©ºçš„entryå¡«å…¥log</span></span><br><span class="line">   <span class="keyword">if</span> !r.appendEntry(emptyEnt) &#123;</span><br><span class="line">      <span class="comment">// This won&#x27;t happen because we just called reset() above.</span></span><br><span class="line">      r.logger.Panic(<span class="string">&quot;empty entry was dropped&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// As a special case, don&#x27;t count the initial empty entry towards the</span></span><br><span class="line">   <span class="comment">// uncommitted log quota. This is because we want to preserve the</span></span><br><span class="line">   <span class="comment">// behavior of allowing one entry larger than quota if the current</span></span><br><span class="line">   <span class="comment">// usage is zero.</span></span><br><span class="line">  <span class="comment">//è¿™é‡Œæ˜¯å‡å»ç©ºentryæ‰€å ç”¨çš„ç©ºé—´</span></span><br><span class="line">   r.reduceUncommittedSize([]pb.Entry&#123;emptyEnt&#125;)</span><br><span class="line">   r.logger.Infof(<span class="string">&quot;%x became leader at term %d&quot;</span>, r.id, r.Term)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="raft-çŠ¶æ€æœºstepå‡½æ•°å¤„ç†"><a href="#raft-çŠ¶æ€æœºstepå‡½æ•°å¤„ç†" class="headerlink" title="raft çŠ¶æ€æœºstepå‡½æ•°å¤„ç†"></a>raft çŠ¶æ€æœºstepå‡½æ•°å¤„ç†</h3><p>stepå‡½æ•°æ˜¯ç”¨æ¥å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯çš„ï¼Œä¸åŒçŠ¶æ€è¦è¿›è¡Œä¸åŒçš„å¤„ç†</p>
<p>é¦–å…ˆæ˜¯æœ‰ä¸€ä¸ªStepå‡½æ•°ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œç”±tickElectionå’ŒtickHeartbeatè°ƒç”¨</p>
<p>åœ¨Stepå‡½æ•°ä¸­æœ‰å¯¹é€‰ä¸¾å’ŒæŠ•ç¥¨çš„å¤„ç†ï¼Œå¯èƒ½è¿™ä¿©ä¸ªè¿‡ç¨‹å¯¹æ¯ä¸ªserveréƒ½å·®ä¸å¤šå§ï¼Œç„¶åå…¶ä»–çš„msgtypeçš„è¯ä¼šåœ¨Stepçš„æœ«å°¾è°ƒç”¨raft.step()æ¥è¿›è¡Œå¤„ç†ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€ä¼šè®¾ç½®ä¸ºä¸åŒçš„stepå‡½æ•°ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯stepLeaderï¼ŒstepFollowerï¼ŒstepCandidateï¼Œå…¶ä¸­åœ¨preCandidateå’Œcandidateè¿™ä¸¤ç§çŠ¶æ€æ˜¯å…±ç”¨ä¸€ä¸ªstepcandidateå‡½æ•°ã€‚è¿™ä¸ªstepåœ¨ä¸Šé¢ä»‹ç»çš„becomeå‡½æ•°ä¸­è®¾ç½®ã€‚</p>
<p>stepå…¶å®å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºçš„å¤„ç†ï¼Œä»–çš„è¾“å…¥æ˜¯å„ç§ç±»å‹çš„msgã€‚æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚ä½†æ˜¯ä¸»è¦æ˜¯æ ¹æ®æ¶ˆæ¯ç±»å‹çš„ä¸åŒä¼šæœ‰ä¸åŒçš„å¤„ç†ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»å„ç§æ¶ˆæ¯ç±»å‹ã€‚</p>
<h3 id="message"><a href="#message" class="headerlink" title="message"></a>message</h3><p>åœ¨raftçš„è®ºæ–‡ä¸­ï¼Œè®¾è®¡äº†å‡ ç§ä¸åŒçš„æ¶ˆæ¯ç±»å‹æ¥åˆ†åˆ«è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä¾‹å¦‚request vote ï¼Œlog replicate ã€‚åœ¨etcdé‡Œé˜¿æ•å°†æ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ”¾åˆ°äº†ä¸€ä¸ªç»Ÿä¸€çš„messageç»“æ„ä½“ï¼Œåœ¨å…¶ä¸­è®¾ç½®äº†æ¶ˆæ¯ç±»å‹ï¼Œæ¯ä¸ªæ“ä½œåªä½¿ç”¨å¯¹åº”çš„å‚æ•°ï¼Œå…¶ä»–çš„å‚æ•°ä¸ºç©ºï¼Œè¿™ä¸ªmessageåœ¨raft.pb.goä¸­å®šä¹‰ã€‚ä¸‹é¢æ˜¯ç»“æ„ä½“çš„å„ç§å‚æ•°</p>
<table>
<thead>
<tr>
<th>message å˜é‡</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Type</td>
<td>MessageType</td>
<td>æ¶ˆæ¯ç±»å‹</td>
</tr>
<tr>
<td>To</td>
<td>uint64</td>
<td>æ¶ˆæ¯å‘å¾€server id</td>
</tr>
<tr>
<td>From</td>
<td>uint64</td>
<td>å‘é€msgçš„server id</td>
</tr>
<tr>
<td>Term</td>
<td>uint64</td>
<td>å‘é€æ—¶çš„current term</td>
</tr>
<tr>
<td>LogTerm</td>
<td>uint64</td>
<td>è®ºæ–‡ä¸­çš„PreLogTerm</td>
</tr>
<tr>
<td>Index</td>
<td>uint64</td>
<td>è®ºæ–‡ä¸­çš„PreIndex</td>
</tr>
<tr>
<td>Entries</td>
<td>[]Entry</td>
<td>ä¼ è¾“çš„éœ€è¦append çš„entries</td>
</tr>
<tr>
<td>Commit</td>
<td>uint64</td>
<td>è®ºæ–‡ä¸­çš„leadercommit</td>
</tr>
<tr>
<td>Snapshot</td>
<td>Snapshot</td>
<td>ä¼ è¾“çš„Snapshotæ•°æ®</td>
</tr>
<tr>
<td>Reject</td>
<td>bool</td>
<td>å†æ¶ˆæ¯å¤„ç†è¿”å›æ—¶è¿›è¡Œæ ‡å¿—ï¼Œä¾‹å¦‚æ‹’ç»æŠ•ç¥¨</td>
</tr>
<tr>
<td>RejectHint</td>
<td>uint64</td>
<td>æ‹’ç»åŒæ­¥æ—¥å¿—è¯·æ±‚æ—¶è¿”å›çš„å½“å‰èŠ‚ç‚¹æ—¥å¿—IDï¼Œç”¨äºè¢«æ‹’ç»æ–¹å¿«é€Ÿå®šä½åˆ°ä¸‹ä¸€æ¬¡åˆé€‚çš„åŒæ­¥æ—¥å¿—ä½ç½®ï¼Œè¿™æ­Œå°±æ˜¯ç”¨æ¥å¿«é€Ÿæ›´æ–°nextçš„</td>
</tr>
<tr>
<td>Context</td>
<td>[]byte</td>
<td>ä¸Šä¸‹æ–‡ä¿¡æ¯</td>
</tr>
</tbody></table>
<h4 id="message-type"><a href="#message-type" class="headerlink" title="message type"></a>message type</h4><table>
<thead>
<tr>
<th>message ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>MsgHup            MessageType &#x3D; 0</td>
<td>ç”¨äºå¼€å¯ä¸€æ¬¡é€‰ä¸¾</td>
</tr>
<tr>
<td>MsgBeat           MessageType &#x3D; 1</td>
<td>ç”¨äºå¼€å¯ä¸€æ¬¡å¿ƒè·³</td>
</tr>
<tr>
<td>MsgProp           MessageType &#x3D; 2</td>
<td></td>
</tr>
<tr>
<td>MsgApp            MessageType &#x3D; 3</td>
<td></td>
</tr>
<tr>
<td>MsgAppResp        MessageType &#x3D; 4</td>
<td></td>
</tr>
<tr>
<td>MsgVote           MessageType &#x3D; 5</td>
<td></td>
</tr>
<tr>
<td>MsgVoteResp       MessageType &#x3D; 6</td>
<td></td>
</tr>
<tr>
<td>MsgSnap           MessageType &#x3D; 7</td>
<td></td>
</tr>
<tr>
<td>MsgHeartbeat      MessageType &#x3D; 8</td>
<td></td>
</tr>
<tr>
<td>MsgHeartbeatResp  MessageType &#x3D; 9</td>
<td></td>
</tr>
<tr>
<td>MsgUnreachable    MessageType &#x3D; 10</td>
<td></td>
</tr>
<tr>
<td>MsgSnapStatus     MessageType &#x3D; 11</td>
<td></td>
</tr>
<tr>
<td>MsgCheckQuorum    MessageType &#x3D; 12</td>
<td></td>
</tr>
<tr>
<td>MsgTransferLeader MessageType &#x3D; 13</td>
<td></td>
</tr>
<tr>
<td>MsgTimeoutNow     MessageType &#x3D; 14</td>
<td></td>
</tr>
<tr>
<td>MsgReadIndex      MessageType &#x3D; 15</td>
<td></td>
</tr>
<tr>
<td>MsgReadIndexResp  MessageType &#x3D; 16</td>
<td></td>
</tr>
<tr>
<td>MsgPreVote        MessageType &#x3D; 17</td>
<td></td>
</tr>
<tr>
<td>MsgPreVoteResp    MessageType &#x3D; 18</td>
<td></td>
</tr>
</tbody></table>
<p>è¿™äº›æ¶ˆæ¯ç±»å‹éƒ½ä¼šåœ¨stepå‡½æ•°ä¸­è¿›è¡Œå¤„ç†ï¼Œä¸åŒçš„æ¶ˆæ¯ç±»å‹ä¼šä½¿ç”¨messageä¸­ä¸åŒçš„å‚æ•°ã€‚</p>
<p>æˆ‘ç°åœ¨åˆ—ä¸€ä¸‹å„ç§åœ¨stepä¸­å¤„ç†çš„æ¶ˆæ¯ç±»å‹ï¼Œç„¶åä»‹ç»ä¸€ä¸‹ä¸åŒçŠ¶æ€çš„serverçš„ä¸åŒå¤„ç†</p>
<h4 id="MsgHup"><a href="#MsgHup" class="headerlink" title="MsgHup"></a>MsgHup</h4><table>
<thead>
<tr>
<th>ä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>è¡¨ç¤ºä¿¡æ¯å‘é€è€…</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªæ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªraftåœ¨æ”¶åˆ°electionè¶…æ—¶çš„æ¶ˆæ¯ä»¥åï¼Œé€šè¿‡ä¸€æ¡MsgHupæ¥è§¦å‘ä¸€æ¬¡é€‰ä¸¾ï¼Œä½¿ç”¨Stepæ¥å¤„ç†MsgHup</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Step å‡½æ•°éƒ¨åˆ†æˆªå–</span></span><br><span class="line"><span class="keyword">case</span> pb.MsgHup: <span class="comment">//è¿™é‡Œå¼€å§‹é€‰ä¸¾</span></span><br><span class="line">   <span class="keyword">if</span> r.preVote &#123; <span class="comment">//æ ¹æ®æ˜¯å¦æ˜¯é€‰ä¸¾æˆ–è€…é¢„é€‰ï¼Œåœ¨hupå‡½æ•°è°ƒç”¨æ—¶ä¼ é€ä¸åŒçš„å‚æ•°</span></span><br><span class="line">      r.hup(campaignPreElection)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      r.hup(campaignElection)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="MsgBeat"><a href="#MsgBeat" class="headerlink" title="MsgBeat"></a>MsgBeat</h4><table>
<thead>
<tr>
<th>ä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>è¡¨ç¤ºä¿¡æ¯å‘é€è€…</td>
</tr>
</tbody></table>
<p>MsgBeatæ¶ˆæ¯æ˜¯åœ¨tickheartå‘ç°å¿ƒè·³æ—¶é—´è¶…æ—¶ä»¥åç”¨æ¥è¿›è¡Œä¸€è½®å¿ƒè·³å‘é€çš„ï¼Œä»–ç»™Stepä¼ è¾“ä¸€ä¸ªMsgBeatæ¶ˆæ¯ï¼Œåœ¨Stepä¸­ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯äº¤ç»™stepLeaderæ¥å¤„ç†</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stepLeader å‡½æ•°éƒ¨åˆ†æˆªå–</span></span><br><span class="line"><span class="keyword">case</span> pb.MsgBeat:</span><br><span class="line">   r.bcastHeartbeat()<span class="comment">//å¼€å¯ä¸€è½®å¿ƒè·³çš„å¹¿æ’­</span></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<h4 id="MsgProp"><a href="#MsgProp" class="headerlink" title="MsgProp"></a>MsgProp</h4><table>
<thead>
<tr>
<th>ä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>è¡¨ç¤ºä¿¡æ¯å‘é€è€…</td>
</tr>
<tr>
<td>to</td>
<td>ä¿¡æ¯è¦å‘é€çš„ç›®çš„id</td>
</tr>
<tr>
<td>Entries</td>
<td>è¦proposeçš„æ•°æ®</td>
</tr>
</tbody></table>
<p>ä¸Šå±‚è¦proposeçš„æ•°æ®å°±ä¼šåŒ…è£…åˆ°è¿™ä¸ªæ¶ˆæ¯ä¸­ä¼ è¾“åˆ°ä¸‹å±‚ï¼Œå¯¹è¿™ä¸ªçš„å¤„ç†å¯¹ä¸åŒçš„raftçŠ¶æ€æœ‰æ‰€ä¸åŒã€‚</p>
<p>åœ¨followeræ”¶åˆ°MsgPropçš„æ—¶å€™ï¼Œä»–ä»¬ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™leaderã€‚candidateæ”¶åˆ°çš„è¯ä¼šç›´æ¥ä¸¢å¼ƒï¼Œå› ä¸ºä»–è®¤ä¸ºå½“å‰æ²¡æœ‰leaderï¼Œè€Œleaderæ”¶åˆ°çš„è¯å°±ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œæ·»åŠ æ•°æ®åˆ°è‡ªå·±çš„logä¸­ã€‚å¹¶ä¸”è¿›è¡ŒbcastAppendã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœproposeçš„æ˜¯é…ç½®æ›´æ”¹çš„æ•°æ®ï¼Œé‚£ä¹ˆleaderè¿˜ä¼šåšä¸€äº›é…ç½®æ›´æ”¹çš„ç›¸å…³æ“ä½œï¼Œè¿™ä¸ªç­‰åˆ°é…ç½®æ›´æ”¹çš„æ—¶å€™å†æ·±å…¥ã€‚</p>
<p>MsgPropæ˜¯ç”±ä¸Šå±‚æˆ–è€…å…¶ä»–followerå‘é€ç»™leaderçš„ã€‚</p>
<h4 id="MsgApp"><a href="#MsgApp" class="headerlink" title="MsgApp"></a>MsgApp</h4><table>
<thead>
<tr>
<th>ä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>è¡¨ç¤ºä¿¡æ¯å‘é€è€…</td>
</tr>
<tr>
<td>to</td>
<td>ä¿¡æ¯è¦å‘é€çš„ç›®çš„id</td>
</tr>
<tr>
<td>Index</td>
<td>preLogInde</td>
</tr>
<tr>
<td>LogTerm</td>
<td>preLogTerm</td>
</tr>
<tr>
<td>commit</td>
<td>Leadercommit</td>
</tr>
<tr>
<td>Entries</td>
<td>è¦appendçš„æ•°æ®</td>
</tr>
</tbody></table>
<p>MsgAppæ¶ˆæ¯åªä¼šç”±leaderå‘é€ç»™å…¶ä»–serverã€‚ç”¨æ¥append entriesã€‚leaderä¼šç»´æŠ¤æ¯ä¸ªserverçš„nextï¼Œå¹¶ä¸”æ›´å…·serveråœ¨leaderçœ¼ä¸­çš„çŠ¶æ€æ¥å‘é€MsgAppã€‚</p>
<p>MsgAppçš„å¤„ç†åœ¨raftä¸­æ˜¯éå¸¸é‡è¦çš„ï¼Œæ˜¯log replicateçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯snapshotçš„å‘é€ã€‚</p>
<p>ä¸åŒçŠ¶æ€æ”¶åˆ°MsgAppçš„å¤„ç†å¹¶ä¸ç›¸åŒï¼Œä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»</p>
<h5 id="leader-å¤„ç†MsgApp"><a href="#leader-å¤„ç†MsgApp" class="headerlink" title="leader å¤„ç†MsgApp"></a>leader å¤„ç†MsgApp</h5><p>ç›´æ¥ä¸¢æ‰ï¼Œå“ˆå“ˆå“ˆï¼Œæ˜¯è¿™æ ·çš„å§ï¼Œå› ä¸ºetcd rafté‡Œé¢ä¸åƒraftè®ºæ–‡ä¸­heart å’Œ append Entryæ˜¯å…±ç”¨ä¸€ä¸ªå¤„ç†ï¼Œåœ¨è¿™ä¸ªraftå®ç°ä¸­ä¼šæ ¹æ®æ¶ˆæ¯ä¸­ç±»å‹æ ‡ç­¾è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆä¸€ä¸ªleaderä¸å¯èƒ½æ”¶åˆ°MsgAppï¼Œæ”¶åˆ°äº†ä¹Ÿä¸å¤„ç†ã€‚</p>
<h5 id="candidate-å¤„ç†MsgApp"><a href="#candidate-å¤„ç†MsgApp" class="headerlink" title="candidate å¤„ç†MsgApp"></a>candidate å¤„ç†MsgApp</h5><ul>
<li>1.é¦–å…ˆå˜æˆfollowerçŠ¶æ€,</li>
</ul>
<blockquote>
<p> è¿™é‡Œå’Œä¹‹ååœ¨stepCandidateï¼Œä»¥åŠstepFollowerï¼ŒstepLeaderä¸­ä¸æåˆ°å…³äºtermçš„åˆ¤æ–­æ˜¯å› ä¸ºåœ¨è°ƒç”¨è¿™ä¸‰ä¸ªå‡½æ•°ä»¥å‰ï¼Œåœ¨Stepä¸­çš„ä¸€å¼€å§‹å°±å¯¹message.termå’Œcurrent termè¿›è¡Œäº†åˆ¤æ–­å’Œå¤„ç†ï¼Œæ‰€ä»¥ä¹‹åçš„è¿™ä¸‰ä¸ªä¸åŒçŠ¶æ€çš„stepå°±ä¸éœ€è¦è€ƒè™‘termäº†ã€‚</p>
</blockquote>
<ul>
<li>2.è°ƒç”¨handleAppendentries æˆ‘å‘ç°è¿™ä¸ªå’Œfolloweræ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯candidateå¤šäº†ä¸€ä¸ªçŠ¶æ€è½¬å˜è€Œå·²</li>
</ul>
<h5 id="follower-å¤„ç†MsgApp"><a href="#follower-å¤„ç†MsgApp" class="headerlink" title="follower å¤„ç†MsgApp"></a>follower å¤„ç†MsgApp</h5><ul>
<li><ol>
<li>r.electionElapsed &#x3D; 0ï¼Œr.lead &#x3D; m.From ä¿©ä¸ªå‚æ•°å¤„ç†ï¼Œé‡åˆ¶é€‰ä¸¾é—´éš”å’Œleaderçš„è®¾ç½®</li>
<li>è°ƒç”¨handleAppendentries</li>
</ol>
</li>
</ul>
<h5 id="handleAppendentries-çœ‹ä¸€ä¸‹æµç¨‹"><a href="#handleAppendentries-çœ‹ä¸€ä¸‹æµç¨‹" class="headerlink" title="handleAppendentries çœ‹ä¸€ä¸‹æµç¨‹"></a>handleAppendentries çœ‹ä¸€ä¸‹æµç¨‹</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ¶ˆæ¯ä¸­çš„preLogIndex è¦å°äºå½“å‰serverçš„commoitedï¼Œè¯´æ˜ä¸éœ€è¦è¿›è¡Œappendï¼Œæˆ–è€…è¿™ä¸ªleaderæ˜¯æ—§çš„</span></span><br><span class="line"><span class="keyword">if</span> m.Index &lt; r.raftLog.committed &#123;</span><br><span class="line">  <span class="comment">//è¿”å›ç°åœ¨serverçš„commitedçš„ä½ç½® è®¾ç½®åˆ°indexå‚æ•°ä¸­</span></span><br><span class="line">   r.send(pb.Message&#123;To: m.From, Type: pb.MsgAppResp, Index: r.raftLog.committed&#125;)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœpreLogIndexæ˜¯å¤§äºç­‰äºcommited é‚£ä¹ˆå°è¯•åŒ¹é…å¹¶ä¸”è¿›è¡Œappend</span></span><br><span class="line"><span class="keyword">if</span> mlastIndex, ok := r.raftLog.maybeAppend(m.Index, m.LogTerm, m.Commit, m.Entries...); ok &#123;</span><br><span class="line">  <span class="comment">//å¦‚æœåŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆå°±æŠŠç°åœ¨æœ€æ–°çš„log çš„indexè¿”å›</span></span><br><span class="line">   r.send(pb.Message&#123;To: m.From, Type: pb.MsgAppResp, Index: mlastIndex&#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   r.logger.Debugf(<span class="string">&quot;%x [logterm: %d, index: %d] rejected MsgApp [logterm: %d, index: %d] from %x&quot;</span>,</span><br><span class="line">      r.id, r.raftLog.zeroTermOnErrCompacted(r.raftLog.term(m.Index)), m.Index, m.LogTerm, m.Index, m.From)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Return a hint to the leader about the maximum index and term that the</span></span><br><span class="line">   <span class="comment">// two logs could be divergent at. Do this by searching through the</span></span><br><span class="line">   <span class="comment">// follower&#x27;s log for the maximum (index, term) pair with a term &lt;= the</span></span><br><span class="line">   <span class="comment">// MsgApp&#x27;s LogTerm and an index &lt;= the MsgApp&#x27;s Index. This can help</span></span><br><span class="line">   <span class="comment">// skip all indexes in the follower&#x27;s uncommitted tail with terms</span></span><br><span class="line">   <span class="comment">// greater than the MsgApp&#x27;s LogTerm.</span></span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">   <span class="comment">// See the other caller for findConflictByTerm (in stepLeader) for a much</span></span><br><span class="line">   <span class="comment">// more detailed explanation of this mechanism.</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//å¦‚æœåŒ¹é…å¤±è´¥ï¼Œé‚£ä¹ˆå°±è¦ç»™leaderæä¾›ä¸€äº›ä¿¡æ¯æ¥å¿«é€Ÿæ›´æ–°next è¿™é‡Œçš„hintIndexå’ŒhintTermçš„å«ä¹‰å’Œ6.824è®²ä¹‰ä¸­çš„åº”è¯¥æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">  </span><br><span class="line">   hintIndex := min(m.Index, r.raftLog.lastIndex())</span><br><span class="line">  </span><br><span class="line"><span class="comment">//findConflictByTerm takes an (index, term) pair (indicating a conflicting log</span></span><br><span class="line"><span class="comment">// entry on a leader/follower during an append) and finds the largest index in</span></span><br><span class="line"><span class="comment">// log l with a term &lt;= `term` and an index &lt;= `index`. If no such index exists</span></span><br><span class="line"><span class="comment">// in the log, the log&#x27;s first index is returned.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The index provided MUST be equal to or less than l.lastIndex(). Invalid</span></span><br><span class="line"><span class="comment">// inputs log a warning and the input index is returned.</span></span><br><span class="line">   hintIndex = r.raftLog.findConflictByTerm(hintIndex, m.LogTerm)</span><br><span class="line">  <span class="comment">//hintIndexæ˜¯è®¡ç®—åå¾—åˆ°çš„ä¸€ä¸ªä½ç½® hintTermæ˜¯å†²çªçš„logçš„term</span></span><br><span class="line">   hintTerm, err := r.raftLog.term(hintIndex)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;term(%d) must be valid, but got %v&quot;</span>, hintIndex, err))</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment">//å‘é€MsgAppRespè¿”å›ç»™leader</span></span><br><span class="line">   r.send(pb.Message&#123;</span><br><span class="line">      To:         m.From,</span><br><span class="line">      Type:       pb.MsgAppResp,</span><br><span class="line">      Index:      m.Index,</span><br><span class="line">      Reject:     <span class="literal">true</span>,</span><br><span class="line">      RejectHint: hintIndex,</span><br><span class="line">      LogTerm:    hintTerm,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MsgAppResp"><a href="#MsgAppResp" class="headerlink" title="MsgAppResp"></a>MsgAppResp</h4><table>
<thead>
<tr>
<th>ä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>è¡¨ç¤ºä¿¡æ¯å‘é€è€…</td>
</tr>
<tr>
<td>to</td>
<td>ä¿¡æ¯è¦å‘é€çš„ç›®çš„id</td>
</tr>
<tr>
<td>Index</td>
<td>è¿™ä¸ªåº”è¯¥æ˜¯serveråœ¨å¤„ç†å®Œappend ä»¥åå¾—åˆ°çš„ï¼Œç°åœ¨å¯ä»¥ç¡®å®šçš„å’ŒleaderåŒ¹é…çš„æœ€å¤§Index</td>
</tr>
<tr>
<td>Reject</td>
<td>appendæ˜¯å¦è¢«æ‹’ç»ï¼Œåªæœ‰ä¸åŒ¹é…ä¼šæœ‰æ‹’ç»</td>
</tr>
<tr>
<td>RejectHint</td>
<td>hintIndex è¿”å›å»æ›´æ–°next å…·ä½“å«ä¹‰å°±çœ‹ä¸Šé¢ä»£ç çš„æ³¨é‡Š</td>
</tr>
<tr>
<td>LogTerm</td>
<td>hintTerm å¯¹åº”äºhintIndexçš„term</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªMsgAppRespåœ¨ä¸åŒçš„å¤„ç†ç»“æœä¸‹çš„è¿”å›å€¼ä¸åŒã€‚ç°åœ¨æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆå¤„ç†MsgAppRespï¼Œè¿™ä¸ªåªæœ‰leaderéœ€è¦å¤„ç†ï¼Œç›´æ¥æ¥çœ‹stepLeaderï¼Œè¿™æ³¨é‡Šæœ‰ç‚¹å¤šï¼Œè€å¿ƒè¯»ä¸€è¯»å§</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> pb.MsgAppResp:</span><br><span class="line">   pr.RecentActive = <span class="literal">true</span> <span class="comment">//è¯´æ˜è¿™ä¸ªserver æœ€è¿‘æ˜¯æ´»è·ƒçš„ä¸æ˜¯unreachable</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> m.Reject &#123;  <span class="comment">//å¦‚æœ reject==true è¯´æ˜æ˜¯å‘ç”Ÿäº†ä¸åŒ¹é…ï¼Œé‚£ä¹ˆfollowerä¼šè¿”å›hintindexå’Œhingtterm</span></span><br><span class="line">      r.logger.Debugf(<span class="string">&quot;%x received MsgAppResp(rejected, hint: (index %d, term %d)) from %x for index %d&quot;</span>,</span><br><span class="line">         r.id, m.RejectHint, m.LogTerm, m.From, m.Index)</span><br><span class="line">     </span><br><span class="line">      nextProbeIdx := m.RejectHint <span class="comment">//è¿™é‡Œç›´æ¥ç”¨ä¼ å›æ¥çš„RejectHintæ¥æ›´æ–° next</span></span><br><span class="line">      <span class="keyword">if</span> m.LogTerm &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨è¿™ä¸ªè¿”å›çš„confilct termä»leaderè‡ªå·±çš„logä¸­æ‰¾åˆ°è¿™ä¸ªtermçš„ç¬¬ä¸€ä¸ªlogçš„index</span></span><br><span class="line">         nextProbeIdx = r.raftLog.findConflictByTerm(m.RejectHint, m.LogTerm)</span><br><span class="line">      &#125;</span><br><span class="line">     </span><br><span class="line">      <span class="keyword">if</span> pr.MaybeDecrTo(m.Index, nextProbeIdx) &#123; <span class="comment">//è¿™æ˜¯ä½¿ç”¨ä¸Šé¢å¾—åˆ°çš„nextProbeIdxå’Œä¹‹å‰è¢«æ‹’ç»çš„m.indexæ¥æ›´æ–°nextã€‚å¦‚æœæ²¡æœ‰æˆåŠŸæ›´æ–°å°±ä¸åšå¤„ç†</span></span><br><span class="line">         r.logger.Debugf(<span class="string">&quot;%x decreased progress of %x to [%s]&quot;</span>, r.id, m.From, pr)</span><br><span class="line">         <span class="keyword">if</span> pr.State == tracker.StateReplicate &#123;</span><br><span class="line">            pr.BecomeProbe()</span><br><span class="line">         &#125;</span><br><span class="line">         r.sendAppend(m.From)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;<span class="comment">//è¿™é‡Œæ˜¯åŒ¹é…æˆåŠŸçš„å¤„ç†æˆ–è€…æ˜¯ m.index&lt;server.commited</span></span><br><span class="line">     </span><br><span class="line">      oldPaused := pr.IsPaused() <span class="comment">//è¿™ä¸ªè¿”å›çš„æ˜¯æ ‡å¿—ä¹‹å‰æ˜¯å¦å‡ºç°è¿‡å› ä¸ºleadertransferç­‰äº‹ä»¶çš„append æš‚åœ</span></span><br><span class="line">      <span class="keyword">if</span> pr.MaybeUpdate(m.Index) &#123;<span class="comment">//è¿™ä¸ªMaybeUpdateæ˜¯çœ‹èƒ½ä¸èƒ½æ›´æ–°matchå’Œnextï¼Œç°åœ¨m.indexæ˜¯serverè¿”å›çš„åŒ¹é…åˆ°çš„logä¸­çš„æœ€å¤§çš„indexã€‚å¦‚æœä¸èƒ½æ›´æ–°matchå’Œnext é‚£å°±ä¸åšå¤„ç†äº†</span></span><br><span class="line">         <span class="keyword">switch</span> &#123; <span class="comment">//å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªserverçš„çŠ¶æ€</span></span><br><span class="line">         <span class="keyword">case</span> pr.State == tracker.StateProbe: <span class="comment">//å¦‚æœæ˜¯æ¢æµ‹çŠ¶æ€è¯´æ˜ç°åœ¨åŒ¹é…æˆåŠŸäº†ï¼Œè½¬æ¢åˆ°replicateçŠ¶æ€</span></span><br><span class="line">            pr.BecomeReplicate()</span><br><span class="line">         <span class="keyword">case</span> pr.State == tracker.StateSnapshot &amp;&amp; pr.Match &gt;= pr.PendingSnapshot:</span><br><span class="line">            <span class="comment">// TODO(tbg): we should also enter this branch if a snapshot is</span></span><br><span class="line">            <span class="comment">// received that is below pr.PendingSnapshot but which makes it</span></span><br><span class="line">            <span class="comment">// possible to use the log again.</span></span><br><span class="line">            r.logger.Debugf(<span class="string">&quot;%x recovered from needing snapshot, resumed sending replication messages to %x [%s]&quot;</span>, r.id, m.From, pr)</span><br><span class="line">            <span class="comment">// Transition back to replicating state via probing state</span></span><br><span class="line">            <span class="comment">// (which takes the snapshot into account). If we didn&#x27;t</span></span><br><span class="line">            <span class="comment">// move to replicating state, that would only happen with</span></span><br><span class="line">            <span class="comment">// the next round of appends (but there may not be a next</span></span><br><span class="line">            <span class="comment">// round for a while, exposing an inconsistent RaftStatus).</span></span><br><span class="line">            pr.BecomeProbe()</span><br><span class="line">            pr.BecomeReplicate()</span><br><span class="line">         <span class="keyword">case</span> pr.State == tracker.StateReplicate:<span class="comment">//å¦‚æœæ˜¯replicateçš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡Šæ”¾ä¸€äº›ç©ºé—´ï¼Ÿ</span></span><br><span class="line">            pr.Inflights.FreeLE(m.Index)</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> r.maybeCommit() &#123; <span class="comment">//åˆ¤æ–­æ˜¯å¦å¯ä»¥æäº¤</span></span><br><span class="line">            <span class="comment">// committed index has progressed for the term, so it is safe</span></span><br><span class="line">            <span class="comment">// to respond to pending read index requests</span></span><br><span class="line">            releasePendingReadIndexMessages(r) <span class="comment">//æœ‰æäº¤çš„è¯å¯ä»¥æ›´æ–°readindex</span></span><br><span class="line">            r.bcastAppend()<span class="comment">//æäº¤æˆåŠŸçš„è¯è¿˜è¦å¹¿æ’­append</span></span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> oldPaused &#123; </span><br><span class="line">            <span class="comment">// If we were paused before, this node may be missing the</span></span><br><span class="line">            <span class="comment">// latest commit index, so send it.</span></span><br><span class="line">            r.sendAppend(m.From) <span class="comment">//å¦‚æœä¹‹å‰è¢«æš‚åœè¿‡ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½è¿˜æœ‰logæ²¡æœ‰apppendï¼Œè™½ç„¶æ²¡æœ‰commitä¹Ÿè¦append</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// We&#x27;ve updated flow control information above, which may</span></span><br><span class="line">         <span class="comment">// allow us to send multiple (size-limited) in-flight messages</span></span><br><span class="line">         <span class="comment">// at once (such as when transitioning from probe to</span></span><br><span class="line">         <span class="comment">// replicate, or when freeTo() covers multiple messages). If</span></span><br><span class="line">         <span class="comment">// we have more entries to send, send as many messages as we</span></span><br><span class="line">         <span class="comment">// can (without sending empty messages for the commit index)</span></span><br><span class="line">         <span class="keyword">for</span> r.maybeSendAppend(m.From, <span class="literal">false</span>) &#123;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// Transfer leadership is in progress.</span></span><br><span class="line">         <span class="keyword">if</span> m.From == r.leadTransferee &amp;&amp; pr.Match == r.raftLog.lastIndex() &#123;</span><br><span class="line">            r.logger.Infof(<span class="string">&quot;%x sent MsgTimeoutNow to %x after received MsgAppResp&quot;</span>, r.id, m.From)</span><br><span class="line">            r.sendTimeoutNow(m.From)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªMsgApprespçš„å¤„ç†å¾ˆéº»çƒ¦å•Šï¼Œç»†èŠ‚éå¸¸å¤šï¼Œè¿˜å¾—å†å¤šçœ‹å‡ éã€‚</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¹‹åå¯ä»¥åœ¨è¿™é‡Œç”¨ä¼ªä»£ç ç®€è¿°ä¸€ä¸‹æµç¨‹</span><br></pre></td></tr></table></figure>

<h4 id="MsgVote-MsgPreVote-MsgVoteResp-MsgPreVoteResp"><a href="#MsgVote-MsgPreVote-MsgVoteResp-MsgPreVoteResp" class="headerlink" title="MsgVote,MsgPreVote,MsgVoteResp,MsgPreVoteResp"></a>MsgVote,MsgPreVote,MsgVoteResp,MsgPreVoteResp</h4><p>è¿™å››ä¸ªå…³äºé€‰ä¸¾å’Œé¢„é€‰ä¸¾æŠ•ç¥¨çš„å‡ ç§æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯éƒ½åœ¨Stepä¸­è¿›è¡Œå¤„ç†ï¼Œå…¶ä»–ç±»å‹çš„æ¶ˆæ¯åœ¨Stepçš„æœ€åä¼šåˆ†å‘ã€‚</p>
<p>è¿™åº”è¯¥æ˜¯å› ä¸ºæŠ•ç¥¨é€‰ä¸¾å¯¹äºæ¯ä¸€ä¸ªraft statuséƒ½æ˜¯åŸºæœ¬ä¸€æ ·çš„æµç¨‹ã€‚</p>
<table>
<thead>
<tr>
<th>MsgVote MsgPreVoteä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Term</td>
<td>å‘é€è€…çš„å½“å‰term</td>
</tr>
<tr>
<td>from</td>
<td>å‘é€è€…id</td>
</tr>
<tr>
<td>to</td>
<td>æ¥æ”¶è€…id</td>
</tr>
<tr>
<td>Index</td>
<td>candidate æœ€åä¸€ä¸ªlogçš„indexï¼Œç”¨æ¥å’Œfollowerå¯¹æ¯”</td>
</tr>
<tr>
<td>LogTerm</td>
<td>candidate æœ€åä¸€ä¸ªlogçš„termï¼Œç”¨æ¥å’Œfollowerå¯¹æ¯”</td>
</tr>
<tr>
<td>Context</td>
<td>è¿™ä¸ªæ˜¯ä¸Šä¸‹æ–‡å‚æ•°ï¼Œæˆ‘ä¸æ˜¯å¾ˆäº†è§£</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>MsgVoteResp MsgPreVoteRespä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Term</td>
<td>è¿”å›å½“å‰çš„term</td>
</tr>
<tr>
<td>from</td>
<td>å‘é€è€…id</td>
</tr>
<tr>
<td>to</td>
<td>æ¥å—è€…id</td>
</tr>
<tr>
<td>reject</td>
<td>æ˜¯å¦æ‹’ç»æŠ•ç¥¨</td>
</tr>
</tbody></table>
<p>è¿™å‡ ä¸ªæ¶ˆæ¯çš„å¤„ç†å°±æ˜¯leader electionçš„æµç¨‹ï¼Œåˆ°åå†æ·±å…¥ï¼Œç°åœ¨åªç»†è‡´çœ‹ä¸€ä¸‹ä»£ç ç»“æ„ã€‚</p>
<h4 id="MsgHeartbeat"><a href="#MsgHeartbeat" class="headerlink" title="MsgHeartbeat"></a>MsgHeartbeat</h4><p>è¿™æ˜¯leaderç”¨æ¥å‘å…¶ä»–çš„followerï¼Œcandidateå‘é€å¿ƒè·³çš„æ¶ˆæ¯</p>
<table>
<thead>
<tr>
<th>MsgHeartbeatä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>leaderå½“å‰çš„term</td>
</tr>
<tr>
<td>from</td>
<td>leader id</td>
</tr>
<tr>
<td>to</td>
<td>æ¥æ”¶è€…id</td>
</tr>
<tr>
<td>Commit</td>
<td>leadercommit</td>
</tr>
<tr>
<td>Context</td>
<td>ä¸Šä¸‹æ–‡å˜é‡ï¼Œä¿å­˜ä¸€è‡´æ€§è¯»ç›¸å…³çš„æ•°æ®</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªæ¶ˆæ¯çš„å¤„ç†æ¯”è¾ƒç®€å•ï¼Œfollowerå’Œcandidateéƒ½éœ€è¦å¤„ç†ï¼Œå¦‚æœæ˜¯æœ‰æ•ˆçš„å¿ƒè·³ï¼Œé‚£ä¹ˆå°±å…ˆbecome followerã€‚</p>
<p>ç„¶ååœ¨handleHeartBeaté‡Œé¢ï¼Œæ˜¯å…ˆçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½æ›´æ–°è‡ªå·±çš„commitã€‚ç„¶åè¿”å›MsgHeartbeat Respæ¶ˆæ¯ã€‚</p>
<h4 id="MsgHeartbeatResp"><a href="#MsgHeartbeatResp" class="headerlink" title="MsgHeartbeatResp"></a>MsgHeartbeatResp</h4><table>
<thead>
<tr>
<th>MsgHeartbeatRespä½¿ç”¨çš„å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>followerå½“å‰çš„term</td>
</tr>
<tr>
<td>from</td>
<td>follower id</td>
</tr>
<tr>
<td>to</td>
<td>æ¥æ”¶leader id</td>
</tr>
<tr>
<td>Context</td>
<td>ä¸Šä¸‹æ–‡å˜é‡ï¼Œä¿å­˜ä¸€è‡´æ€§è¯»ç›¸å…³çš„æ•°æ®</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªæ¶ˆæ¯åªæœ‰leaderéœ€è¦å¤„ç†ï¼Œåœ¨stepleaderä¸­è¿›è¡Œï¼Œæœ‰ä¸€äº›å…³äºreadonlyçš„æˆ‘ç°åœ¨è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚å¾—å†å­¦ä¹ ä¸€ä¸‹</p>
<h4 id="MsgUnreachable"><a href="#MsgUnreachable" class="headerlink" title="MsgUnreachable"></a>MsgUnreachable</h4><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªæœ¬åœ°æ¶ˆæ¯ï¼Œä¸Šå±‚å‘Šè¯‰leaderï¼Œç›®çš„idæ˜¯ä¸å¯è¾¾çš„ï¼Œä¸‹é¢æ˜¯docä¸­çš„ä¸€äº›æè¿°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27;MsgUnreachable&#x27; tells that request(message) wasn&#x27;t delivered. When</span><br><span class="line">&#x27;MsgUnreachable&#x27; is passed to leader&#x27;s Step method, the leader discovers</span><br><span class="line">that the follower that sent this &#x27;MsgUnreachable&#x27; is not reachable, often</span><br><span class="line">indicating &#x27;MsgApp&#x27; is lost. When follower&#x27;s progress state is replicate,</span><br><span class="line">the leader sets it back to probe.</span><br></pre></td></tr></table></figure>

<h4 id="MsgSnap"><a href="#MsgSnap" class="headerlink" title="MsgSnap"></a>MsgSnap</h4><p>leaderç”¨MsgSnapæ¥å‘followerå‘é€å¿«ç…§ï¼Œåœ¨log repliacateæ—¶ï¼Œå¦‚æœleaderå‘ç°ä¸€ä¸ªè¦ç»™followerå‘çš„logçš„ä¿¡æ¯å·²ç»è¢«è‡ªå·±å‹ç¼©äº†ï¼Œé‚£ä¹ˆå°±æ‰¾ä¸åˆ°logä¿¡æ¯äº†ï¼Œæ­¤æ—¶å°±éœ€è¦å‘é€snapshotæ¥è®©followerå’Œè‡ªå·±ä¿æŒåŒæ­¥ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æˆå‘˜</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">to</td>
<td>æ¶ˆæ¯æ¥æ”¶è€…çš„èŠ‚ç‚¹ID</td>
</tr>
<tr>
<td align="left">from</td>
<td>èŠ‚ç‚¹ID</td>
</tr>
<tr>
<td align="left">snap</td>
<td>è¦å‘é€çš„snapæ•°æ®</td>
</tr>
</tbody></table>
<h4 id="MsgSnapStatus"><a href="#MsgSnapStatus" class="headerlink" title="MsgSnapStatus"></a>MsgSnapStatus</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x27;MsgSnapStatus&#x27; tells the result of snapshot install message. When a</span><br><span class="line">follower rejected &#x27;MsgSnap&#x27;, it indicates the snapshot request with</span><br><span class="line">&#x27;MsgSnap&#x27; had failed from network issues which causes the network layer</span><br><span class="line">to fail to send out snapshots to its followers. Then leader considers</span><br><span class="line">follower&#x27;s progress as probe. When &#x27;MsgSnap&#x27; were not rejected, it</span><br><span class="line">indicates that the snapshot succeeded and the leader sets follower&#x27;s</span><br><span class="line">progress to probe and resumes its log replication.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">æˆå‘˜</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">to</td>
<td>æ¶ˆæ¯æ¥æ”¶è€…çš„èŠ‚ç‚¹ID</td>
</tr>
<tr>
<td align="left">from</td>
<td>èŠ‚ç‚¹ID</td>
</tr>
<tr>
<td align="left">reject</td>
<td>æ˜¯å¦æ‹’ç»</td>
</tr>
</tbody></table>
<p>è¿™ä¸ªæ¶ˆæ¯æ˜¯ç”¨æ¥å‘leaderè¿”å›snapshotçš„ç»“æœçš„ï¼Œå¦‚æœfolloweræ¥æ”¶æˆåŠŸï¼Œå°±æŠŠå®ƒçš„çŠ¶æ€è®¾ç½®ä¸ºprobeï¼Œå¦‚æœæ¥å—å¤±è´¥é‚£ä¹ˆä¹Ÿä¼šæŠŠå®ƒçš„çŠ¶æ€è®¾ç½®ä¸ºprobeï¼Œä½†æ˜¯snapshotæ²¡æœ‰æäº¤ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œåŸå› ï¼Œä¹‹ååº”è¯¥ä¼šç»§ç»­å°è¯•snapã€‚</p>
<h4 id="MsgCheckQuorum"><a href="#MsgCheckQuorum" class="headerlink" title="MsgCheckQuorum"></a>MsgCheckQuorum</h4><h4 id="MsgTransferLeader"><a href="#MsgTransferLeader" class="headerlink" title="MsgTransferLeader"></a>MsgTransferLeader</h4><h4 id="MsgTimeoutNow"><a href="#MsgTimeoutNow" class="headerlink" title="MsgTimeoutNow"></a>MsgTimeoutNow</h4><h4 id="MsgReadIndex"><a href="#MsgReadIndex" class="headerlink" title="MsgReadIndex"></a>MsgReadIndex</h4><h4 id="MsgReadIndexResp"><a href="#MsgReadIndexResp" class="headerlink" title="MsgReadIndexResp"></a>MsgReadIndexResp</h4><h3 id="raftlog-1"><a href="#raftlog-1" class="headerlink" title="raftlog"></a>raftlog</h3><p>raftlogæ˜¯ç”¨æ¥å¯¹raftçš„æ—¥å¿—è¿›è¡Œç®¡ç†çš„ç»“æ„ã€‚</p>
<p>f2  </p>
<p>c1   </p>
<p>L1  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">IoCing</p>
  <div class="site-description" itemprop="description">å’Œèµ–èµ–å¿«ä¹å¼€å¿ƒæ¯ä¸€å¤©ğŸŒ¼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IoCing</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">17k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">15 mins.</span>
</div>

<!--
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
